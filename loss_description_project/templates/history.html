<!DOCTYPE html>
<html>
<head>
    <title>Assessment History - ClaimInsight</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Header -->
    <header style="background-color: rgba(0, 119, 182, 0.9); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; height: 150px; position: fixed; width: 100%; top: 0; z-index: 1000;">
        <div style="display: flex; align-items: center; gap: 25px;">
            <div style="height: 120px; width: 120px; background-color: white; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                <span style="font-size: 24px; font-weight: bold; color: #0077B6;">CI</span>
            </div>
            <h1 style="margin: 0; font-size: 36px;">ClaimInsight</h1>
        </div>
        <div>
            <button onclick="location.href='/'" style="margin-right: 15px; padding: 12px 24px; background-color: white; color: #0077B6; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 16px;">Home</button>
            <button onclick="openSidebar()" style="padding: 12px 24px; background-color: white; color: #0077B6; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 16px;">About Us</button>
        </div>
    </header>

    <!-- History Button -->
    <div class="history-button" style="position: fixed; top: 170px; right: 20px; z-index: 999;">
        <a href="/history" class="history-link">
            <svg class="history-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            History
        </a>
    </div>

    <!-- Main Content -->
    <div style="margin-top: 170px;">
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index: -1; opacity: 0.9;"></div>
        
        <div class="history-container">
            <div class="detection-history">
                <h1 style="color: #0077B6; margin-bottom: 30px; text-align: center;">Assessment History</h1>
                <button class="action-button clear-btn" onclick="clearHistory()" style="margin-bottom: 20px;">Clear History</button>
                
                {% if history %}
                <table>
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Damage Type</th>
                            <th>Image Analysis</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in history %}
                        <tr>
                            <td>{{ entry.date }}</td>
                            <td>{{ entry.damage_type }}</td>
                            <td style="max-width: 300px; word-wrap: break-word;">{{ entry.image_caption }}</td>
                            <td>
                                <button class="download-btn" onclick="viewDescription(`{{ entry.loss_description | replace('\n', '\\n') | replace('"', '\\"') }}`, `{{ entry.damage_type }}`)">View Description</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p style="text-align: center; color: #666; font-size: 1.2rem; margin-top: 50px;">No assessment history found.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        function clearHistory() {
            if (confirm('Are you sure you want to clear all history? This action cannot be undone.')) {
                fetch('/clear_history', {
                    method: 'POST',
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert('Error clearing history');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error clearing history');
                });
            }
        }

        function viewDescription(description, damageType) {
            // Show description in alert for now
            alert(`Damage Type: ${damageType}\n\nDescription:\n${description.replace(/\\n/g, '\n')}`);
        }

        function openSidebar() {
            // You can implement sidebar here if needed
            alert('About ClaimInsight: AI-powered insurance loss description generator');
        }
    </script>
</body>
</html>